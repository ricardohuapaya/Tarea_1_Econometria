---
title: "Solución Tarea 1"
author: "Integrantes: María Fernanda Villalobos Barboza B78304, Ricardo Huapaya Rey B83936, Sebasthián Valverde Martínez B98083"
date: '`r format(Sys.Date(), "%d %b, %Y")`'
output:
  html_document: default
  word_document: default
theme: "journal"
---

```{r setup, echo=FALSE, results='hide', message=FALSE}

knitr::opts_chunk$set(echo = TRUE)

library(ggplot2)
library(readxl)
library(dplyr)
library(stargazer)

setwd("C:/Users/FamiliaFeliz/Documents/GitHub/Tarea_1_Econometria")

cigs = read_excel("Data/CigarettesB.xlsx")

energy = read_excel("Data/Electricity1970.xlsx")

datos_reg <- select(energy, Costo= COST, Produccion = output, Trabajo=labor,
                Capital=capital, Combustible=fuel    )

euroenergy = read_excel("Data/EuroEnergy.xlsx")
```


En este presente documento se procede a realizar un analisis econometrico de diversas bases de datos de interes. Para ello se selecionaron las bases:

-   2.2 CigarettesB: Cigarette Consumption Data

-   2.6 Electricity1970: Cost Function of Electricity Producers 1970

-   2.7 EuroEnergy: European Energy Consumption Data.

La estructura del documento es de un analisis individual en el orden mencionado previamente. Para así al final discutir en una última sección las conclusiones de cada analisis.

## 1. Analisis Cigarettes Data

Para la base de datos 2.2 tomaremos la variable `PACKS` como nuestra variable dependiente que será analizada. Esta variable representa el numero de paquetes consumidos por personas mayores de 16 años en casa Estado; asi nuestro modelo propuesto para el primer analsis sería de la forma:

$$
ln(PACKS) = \beta_{0}+\beta_{1}ln(price)+\beta_{2}ln(income)+\mu
$$

### 1.1 Resumen Información


Realizamos un analisis grafico para nuestras 3 variables: ``PACKS``, ``income`` y ``price``; se puede apreciar en el siguiente gráfico que existe cierto nivel de correlación negativa entre el consumo y el precio. 

```{r, echo = FALSE}
ggplot( data = cigs, 
        mapping = aes(
          x = price,
          y = PACKS
      )) + geom_point(color = "red") +
  labs( title = "Consumo de Cigarros y Precio",
        subtitle = "Escala Logaritmitca",
        x = "Precio",
        y = "Paquetes de cigarrillos consumidos"
  )+theme_grey() + scale_radius(3)

```

Por otra parte, note que si realizamos un grafico similar al previo donde comparamos el ingreso medio por estado con el consumo medio por persona en cada estado, se infiere que no existe una correlación entre ambas variables. 

```{r, echo=FALSE}
ggplot( data = cigs, 
        mapping = aes(
          x = income,
          y = PACKS
      )) + geom_point(color = "red") +
  labs( title = "Consumo de Cigarros e Ingreso",
        subtitle = "Escala Logaritmitca",
        x = "Ingreso",
        y = "Paquetes de cigarrillos consumidos"
  )+theme_grey() + scale_radius(3)
```

Haciendo un analisis de correlacion promieamente entre la variable ``PACKS`` y cada una de sus variables explicativas nos da un resultado similar a la intuición grafica. El resultado matematico indica que existe una correlación negativa debil entre ingreso y la cantidad de cigarros consumidos.

```{r, echo=FALSE}
round(cor(cigs), 2)
```


### 1.2 Regresión Lineal

Con el fin de analizar la regresión lineal de nuestras variables, utilizaremos el siguiente codigo:

```{r, warning = FALSE}
linear.cigs <-lm(PACKS ~ price+income, data=cigs)
```

El cual nos muestra que en promedio se consumiria $4.3$ paquetes de cigarillos si el precio y los ingresos fueran $0$. En este otro caso note que dada la definición del modelo $\beta_{1}$ es un indicador de Elasticidad precio de la demanda de cigarrillos. Considere que al ser mayor a uno no sigue la intuición econimica incial que los cigarrillos son ineslasticos. 

```{r, echo=FALSE, warning=FALSE}
stargazer(linear.cigs, type = "text", title = "Cuadro #1: Resultados Regresión")
coef = coefficients(linear.cigs)
```

### 1.3 Pruebas t
Utilizando la misma función que en la pregunta anterior, y el cuadro 1 se obtiene la información necesaria para obtener los resultados de la prueba $t$.

Tomando $H_{0}: B_{1}=0$ (Precio no tiene efecto en consumo) La prueba $t$ realizada para el precio nos devuelve un P-value de 0.000168, entonces con un nivel de significancia del 5% podemos rechazar la hipotesis nula donde el precio del paquete no afecta el consumo. 

Tomando $H_{0}: B_{2}=0$  (Ingreso no tiene efecto en consumo) La prueba t realizada para el ingreso nos devuelve un P-Value de 0.386 el cual, entonces con un nivel de significancia del 5% podemos no podemos rechazar la hipotesis nula donde el precio del paquete no afecta el consumo. 

### 1.4 Pruebas F

Tomando una prueba de significancia conjunta tal que nuestra hipotesis nula sea; $H_{0}: B_{1}=B_{2}=0$. 


## 2. Analisis Energy

Para la base de datos 2.6 tomaremos la variable `Costo` como nuestra variable dependiente que será analizada. Esta variable representa el costo en dolares por cada mil kwh. Las variables explicativas el salario promedio de la firma, el indice de capital, el precio de combustible y el output final en millones de kwh.

$$
Costo = \beta_{0}+ \beta_{1}trabajo+\beta_{2}capital+\beta_{3}producción+\beta_{4}combustible +\mu
$$

### 2.1 Resumen: Analisis Descriptivo

Realizamos un analisis grafico para nuestras 5 variables: ``Costo``, ``Trabajo``, ``Capital``, ``Producción`` y ``Combustible``; se ve que existe una correlación positiva con las variables explicativas.
Esto quiere decir que conforme la variable `Costo` incremente las variables explicativas mencionadas también aumentaran.

```{r, echo = FALSE}
ggplot( data = datos_reg, 
        mapping = aes(
          x = Produccion,
          y = Costo
      )) + geom_point(color = "red") +
  labs( title = "Relacion Costo y Producción de Energia",
        #subtitle = "En ",
        x = "Millones de kwh producidos ",
        y = "Costo por cada 1000 hwh"
  )+theme_grey() + scale_radius(3)

```

```{r, echo = FALSE}
ggplot( data = datos_reg, 
        mapping = aes(
          x = Trabajo,
          y = Costo
      )) + geom_point(color = "red") +
  labs( title = "Relacion Costo y Salario Promedio",
        #subtitle = "En ",
        x = "Salario Promedio",
        y = "Costo por cada 1000 hwh"
  )+theme_grey() + scale_radius(3)

```


```{r, echo = FALSE}
ggplot( data = datos_reg, 
        mapping = aes(
          x = Capital,
          y = Costo
      )) + geom_point(color = "red") +
  labs( title = "Relacion Costo e Indice de Capital",
        #subtitle = "En ",
        x = "Indice de Capital",
        y = "Costo por cada 1000 hwh"
  )+theme_grey() + scale_radius(3)

```

```{r, echo = FALSE}
ggplot( data = datos_reg, 
        mapping = aes(
          x = Capital,
          y = Combustible
      )) + geom_point(color = "red") +
  labs( title = "Relacion Costo y Precio de Combustible",
        #subtitle = "En ",
        x = "Precio de combustible",
        y = "Costo por cada 1000 hwh"
  )+theme_grey() + scale_radius(3)

```

```{r, echo=FALSE}
round(cor(datos_reg),2)  
```
### 2.2 Regresión Lineal

Con el fin de analizar la regresión lineal de nuestras variables, utilizaremos el siguiente codigo:

```{r, warning = FALSE}
linear.energy <- lm( Costo ~ Produccion + Trabajo + Capital + Combustible, data= datos_reg)
```

```{r, echo=FALSE, warning=FALSE}
stargazer(linear.energy, type = "text", title = "Cuadro #2: Resultados Regresión")
coef = coefficients(linear.energy)
```
Cuando las variables explicativas toman el valor de 0 los costos son negativos. Cabe resaltar que _las tres primeras variables explicativas_ tienen rendimientos decrecientes luego la cuarta variable de combustible  presenta redimientos crecientes a escala.

### 2.3 Pruebas t
```{r}
summary(linear.energy)
```
Viendo los resultados de las pruebas T con una Ho: B´s=0; se puede afirmar con un nivel de significancia del 5% que los coeficientes no son iguales a 0, esto quiere decir que se rechaza la Ho


### 2.4 Prueba F
```{r}
summary(linear.energy)
```
Interpretando la prueba F de significancia conjunta del modelo con la función summary donde la Ho: B´s(en conjunto)= 0 se puede afirmar que 
los coeficientes de las variables explicativas no son 0 ya que el p-value asociado a la prueba es practicamente 0.

## 3. Analisis Euroenergy

Para esta base de datos se tiene información relevante respecto al consumo de enerergia de 20 paises. Solamente se tienen dos variables numéricas dentro de la base de datos: 
-  *energy*, el consumo agregado de energia en millones de kilogramos equivalentes de Carbon. 
-  *GDP*, el PIB real de cada paises de 1980 a precios de 1975.

Para este caso, probamos cual variable le quedan mejor la cataegoria de variable independiente. 

### 3.1 Resumen: Analisis Descriptivo

Realizando un gráfico de puntos con la variable ``energy`` como variable dependiente y la variable ``GDP`` como variable explicativa, puede verse una cierta correlación. Parece ser que, ante incrementos en el GDP, surgen también aumentos en el consumo de energía. En otras palabras, conforme se incrementa el producto, el consumo de energía tiende a la alza (parece que ambas se relacionan positivamente) Lo anterior se demuestra en el siguiente gráfico:

```{r, echo =FALSE}
euroenergy$GDP_1 = euroenergy$GDP/100000
euroenergy$energy_1 = euroenergy$energy/100000
ggplot( data = euroenergy, 
        mapping = aes(
          x = GDP_1,
          y = energy_1
      )) + geom_point(color = "red") +
  labs( title = "Europa: Nivel del PIB Real y Consumo de Energía",
        subtitle = "En miles de millones de dolares y miles de millones de kg",
        x = "PIB Real",
        y = "Consumo de Energía"
  )+theme_grey() + scale_radius(3)
```
Al pasar se un analisis grafico a uno matematico vemos que efectivamente existe una correlación fuerte, 
```{r, echo=FALSE}
print('Calculo de Correlación: ') 
cor(euroenergy$GDP, euroenergy$energy)
```
### 3.2 Regresión Lineal

Definamos los siguientes casos:

*Caso a*: "energy" es la variable dependiente (es el caso a desarrollar):

$$
energy = \beta_{0}+\beta_{1}GDP+\mu
$$

Se utiliza el siguiente código.

```{r, warning = FALSE}
linear.1 <- lm(energy ~ GDP, data = euroenergy)
stargazer(linear.1, type = "text", title = "Cuadro #3: Resultados Regresión")
coef = coefficients(linear.1)
```

El resultado que se obtiene indica que, cuando el GDP es nulo, el consumo de energía es negativo. Por cada unidad adicional de GDP, el consumo de energía se incrementa en 0.78 (aproximadamente). Casi tiene una relación de uno a uno.

*Caso b*: "GDP" es la variable dependiente (definido únicamente para este inciso a fin de determinar, por curiosidad, qué ocurre cuando el GDP es la variable dependiente):

$$
ln(GDP) = \beta_{0}+\beta_{1}ln(energy)+\mu
$$

```{r, warning = FALSE}
linear.2 <- lm(GDP ~ energy, data = euroenergy)
stargazer(linear.2, type = "text", title = "Cuadro #4: Resultados Regresión")
coef = coefficients(linear.2)
```

Cuando el consumo de energía es nulo, el GDP es positivo. Por cada unidad adicional de energía, el GDP se incrementa en 1.23 aproximadamente.

### 3.3 Pruebas t

El valor de hacer ambos casos es notar la importancia de comprender los datos. Note que el caso donde obtenemos mejor información es del *caso a*; ya que del caso *caso b* tendriamos que el consumo de energia aumenta el PIB. Lo anterior no sentido y nos revela que ambas variables sostienen una relación espuría.

Utilizando la misma función que en la pregunta anterior, y el cuadro 3 se obtiene la información necesaria para obtener los resultados de la prueba $t$.

Tomando $H_{0}: B_{1}=0$, La prueba $t$ realizada para el PIB nos devuelve un P-value de #PONER NUMERO, entonces con un nivel de significancia del 5% podemos rechazar la hipotesis nula donde el nivel de GDP no afecta el nivel de consumo de energia. 


### 3.4 Pruebas F

_Note que al haber solo una variable explicativa no es necesario hacer una prueba de significancia conjunta._

## Conclusión



